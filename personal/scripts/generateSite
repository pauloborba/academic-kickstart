#!/usr/bin/env bash

# TODO
#
# alterar sitemap para conter PDFs?
# verificar video de oopsla e do spg
# copy essential info from short CV (service)
# pÃ¡gina com CV curto em ingles e link pra o lattes, ao inves de 
#    linkar para o lattes direto do logo CV
# add more pdfs for articles (OK up to 2016)
# add featured publications section
# add resources to .gitignore
# fix Disqus issue, or remove it
# copy student info from Lattes, as done for publications
# add students pictures and home pages, and former students too
# progressively copy stuff from federated wiki and SPG internal links
# improve and document scripts, including this one!
# eliminate need to update variable anos in lattes2json.rb
#
# add error handling (abort if files not available, especially curriculo.xml, do not rm files if others have not been created!)
#

# BEFORE CALLING THIS SCRIPT
#
# Download "curriculo.xml" file from Lattes (through the search CV option, not 
# the update CV option). 
#
# Store it in the "files" directory (homepage/personal/scripts/files).
# We assume it's named "curriculo.xml".
#
# Update variable anos in personal/scripts/lattesXml2Json/lattes2json.rb. 

#
# generating JSON from Lattes XML, in personal/scripts
#
cd lattesXml2Json
mv ../files/curriculo.xml vitaeCNPq.xml
ruby lattes2Json.rb > ../files/novoCurriculoBaixadoDoLattes.json
rm vitaeCNPq.xml

#
# merging new and old JSONs
#
cd ../jsonMerge
node jsonMerge ../files/curriculoAtual.json ../files/novoCurriculoBaixadoDoLattes.json ../files/novoCurriculoIntegrado.json
cd ../files
rm novoCurriculoBaixadoDoLattes.json
rm curriculoAnterior.json
mv curriculoAtual.json curriculoAnterior.json
mv novoCurriculoIntegrado.json curriculoAtual.json

#
# AFTER CALLING THIS SCRIPT
#
# Manually edit files/curriculoAtual.json removing conflicts (inspect output log generated by 
#   this script, or look for <<< old === new >>> in curriculoAtual.json), 
#   and adding extra information (pdf files, replication packages, slides, etc.) to the new entries (look for "in new but not in old" in the log). 
# PDF files of new articles and slides should be added to scripts/jsonToSite/resources/pdffiles
# If there are new author and journal name issues (like due to accents ou uppercase), 
#    assess if it's better 
#    to solve them directly at Lattes GUI or adapting the script in lattesXml2Json 
#    (in this case should download or rename the XML file and run this script again!)
#
# After that, clean the jsonToSite/output directory and call the jsonToSite script.
#
# cd ../jsonToSite/output
# rm -R *
# node ../jsonToSite
#
# And then copy the newly generated publications to the content directory
# (which is used as the basis to generate the site)
#
# cp ../../../../content/publication/_index.md .
# rm -R ../../../../content/publication/*
# mv * ../../../../content/publication
#


# Also start from here if manually changing the website files in homepage/content, or creating new posts
#  
# Test the website
#
# cd ../../../../   # going back to homepage folder
# hugo --i18n-warnings server
#
# If everything is OK (check http://localhost:1313/), generate and put the website in public
#  
# hugo
#
# And commit new website version and upload it to github.io
# The public folder is the generated website content mapped to pauloborba.github.io
#
# cd public
# git add .
# git commit -m "new version of the website"
# git push origin master
# cd ..
#
# Finally, commit new content version and upload it to my academic fork.
# The homepage folder is my academic-kickstart fork, containing my website source code, 
# scripts, pdf files, and all material that is used to generate the actual
# website content.
#
# git status
# git add content/publication/*     # ou o que tiver sido modificado
# git commit -m "new version of the website"
# git push origin master
#
# Load new sitemap (https://github.com/pauloborba/pauloborba.github.io/blob/master/sitemap.xml) 
#   in https://search.google.com/search-console?resource_id=https%3A%2F%2Fpauloborba.github.io%2F
#
# Eventually update academic by calling the update_academic.sh script
# or following the instructions in https://sourcethemes.com/academic/docs/update/
# academic is mapped to the original academic repo and contains the generic 
# infrastructure for generating sites
#
# To create a post
#
# hugo new --kind post post/my-article-name
#
# To create a project
#
# hugo new --kind project project/my-project-name
#
# To create a talk ou podcast
#
# hugo new --kind talk talk/my-talk-name
#
# To adapt the menu: config/menus.toml
# To adapt the first section of the page: content/authors/admin/_index.md
#
# Further instructions on https://sourcethemes.com/academic/docs/managing-content/

